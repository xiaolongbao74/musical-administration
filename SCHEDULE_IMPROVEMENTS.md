# スケジュール管理機能の改善

## 📋 変更内容

### 1. 出欠入力の改善 ✅

**以前の問題:** 小さいテキストボックスで入力しにくかった

**新しい機能:**
- **クリック**: セルをクリックするだけで ○ → △ → × → 空白 を順番に切り替え
- **ダブルクリック**: セルをダブルクリックでテキスト入力モード（任意の文字列を入力可能）

**使い方:**
1. 出欠欄のセルを**1回クリック** → ○/△/×が順番に切り替わる
2. 特別な状況（例: "遅刻", "早退", "14時から"）を入力したい場合は**ダブルクリック**
3. プロンプトが表示されるので、テキストを入力してOK

### 2. CSVインポート/エクスポート機能追加 ✅

**新機能:**
- スケジュールをCSV形式でエクスポート可能
- CSVファイルからスケジュールを一括インポート可能
- サンプルCSVファイル付き (`sample_data/schedules.csv`)

**ボタン:**
- 「CSVエクスポート」: 現在のスケジュールをCSVファイルとしてダウンロード
- 「CSVインポート」: CSVファイルからスケジュールを一括登録

## 📥 更新手順

### ステップ1: 更新版をダウンロード

すべての改善が含まれた更新版をダウンロードしてください。

### ステップ2: ファイルを更新

以下のファイルを `D:\tom` にコピー（上書き）：

**バックエンド:**
- `backend/routes/schedules.js` （CSVインポート/エクスポート追加）

**フロントエンド:**
- `frontend/src/components/AdminSchedule.jsx` （UI改善 + CSV機能）

**サンプルデータ:**
- `sample_data/schedules.csv` （新規）

### ステップ3: GitHubにプッシュ

PowerShellで：

```powershell
cd D:\tom

# 変更をステージング
git add backend/routes/schedules.js
git add frontend/src/components/AdminSchedule.jsx
git add sample_data/schedules.csv
git add README.md

# コミット
git commit -m "Improve schedule attendance input and add CSV import/export"

# プッシュ
git push
```

### ステップ4: Renderの再デプロイを待つ

- 自動的にバックエンドとフロントエンドが再デプロイされます
- 3-5分待ちます
- 完了したらページをリロード

## 🎯 使い方

### 出欠の入力

1. **スケジュール管理**を開く
2. 出欠欄をクリック → ○/△/×が切り替わる
3. 特殊な状況はダブルクリックでテキスト入力

### CSVエクスポート

1. **スケジュール管理**を開く
2. 「CSVエクスポート」ボタンをクリック
3. `schedules.csv` がダウンロードされる
4. ExcelやGoogleスプレッドシートで編集可能

### CSVインポート

1. CSVファイルを準備（サンプル: `sample_data/schedules.csv`）
2. **スケジュール管理**を開く
3. 「CSVインポート」ボタンをクリック
4. CSVファイルを選択
5. インポート完了のメッセージが表示される
   - 新規追加された件数
   - 更新された件数

**重要:** 
- **同じ日付+会場+開始時間のスケジュールがあれば更新**
- **なければ新規追加**
- **CSVにないスケジュールはそのまま残る**

例：
- 12/1 第1スタジオ 10:00のスケジュールが既にある → 内容が更新される
- 12/2 第2スタジオ 14:00のスケジュールは初めて → 新規追加される
- 既存の12/15のスケジュールはCSVにない → そのまま残る

## 📝 CSVファイル形式

### スケジュールCSVの例

```csv
schedule_date,venue,start_time,end_time,rehearsal_type,rehearsal_content,target_songs,target_roles
2025-12-01,第1スタジオ,10:00,12:00,音楽稽古,第1場の曲を中心に,"[1,2,3]","[""トム"",""ハティ""]"
2025-12-02,第1スタジオ,14:00,17:00,立ち稽古,第2場全体,"[4,5]","[]"
2025-12-03,第2スタジオ,10:00,13:00,通し稽古,第1場〜第3場,"[1,2,3,4,5,6,7]","[]"
```

### フィールド説明

| フィールド | 説明 | 例 |
|-----------|------|-----|
| `schedule_date` | 日付 | 2025-12-01 |
| `venue` | 会場 | 第1スタジオ |
| `start_time` | 開始時間 | 10:00 |
| `end_time` | 終了時間 | 12:00 |
| `rehearsal_type` | 稽古種類 | 音楽稽古 |
| `rehearsal_content` | 稽古内容 | 第1場の曲を中心に |
| `target_songs` | 対象曲ID（JSON配列） | `[1,2,3]` または `[]` |
| `target_roles` | 対象役（JSON配列） | `["トム","ハティ"]` または `[]` |

### 重要な注意点

**JSON配列の書き方:**
- 空の場合: `[]`
- 数値の配列: `[1,2,3]`
- 文字列の配列（CSV内）: `"[""値1"",""値2""]"`
  - 引用符を二重にする必要があります

**推奨方法:**
1. まずシステムでスケジュールをいくつか登録
2. CSVエクスポートして形式を確認
3. そのファイルをテンプレートとして編集

## ✨ 改善のメリット

### 出欠入力
- ✅ クリック1回で入力完了
- ✅ 操作が直感的
- ✅ スマホでも使いやすい
- ✅ 入力スピードが大幅に向上

### CSV機能
- ✅ Excelでスケジュールを一括作成
- ✅ バックアップが簡単
- ✅ 他のシステムとデータ連携可能
- ✅ 大量のスケジュールを効率的に登録

## 🆘 トラブルシューティング

### クリックしても反応しない
- ページを完全にリロード（Ctrl+F5）
- ブラウザのキャッシュをクリア

### CSVインポートでエラー
- UTF-8 BOM付きで保存されているか確認
- JSON配列の形式が正しいか確認（`[]` や `[1,2,3]`）
- エクスポートしたファイルと形式を比較

### ダブルクリックで入力できない
- シングルクリックと間隔を空けてダブルクリック
- または、最初にエクスポートしてExcelで編集し、再インポート

ご質問があればお気軽にどうぞ！
